<!--
  CR-API Security Rules for Wazuh
-->

<group name="crapi,web,application">

  <!-- CR-API Authentication Failures -->
  <rule id="100001" level="5">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-identity</field>
    <regex>authentication.failed|login.failed|invalid.credentials</regex>
    <description>CR-API: Authentication failure detected</description>
    <group>authentication_failed,crapi</group>
  </rule>

  <!-- CR-API SQL Injection Attempts -->
  <rule id="100002" level="10">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>union.select|drop.table|insert.into|delete.from|'.*or.*'|".*or.*"|1=1</regex>
    <description>CR-API: SQL Injection attempt detected</description>
    <group>sql_injection,crapi,attack</group>
  </rule>

  <!-- CR-API XSS Attempts -->
  <rule id="100003" level="8">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>&lt;script|javascript:|onerror=|onload=|alert\(|document\.cookie</regex>
    <description>CR-API: Cross-Site Scripting (XSS) attempt detected</description>
    <group>xss,crapi,attack</group>
  </rule>

  <!-- CR-API Command Injection -->
  <rule id="100004" level="12">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>;\s*cat|;\s*ls|;\s*rm|;\s*wget|;\s*curl|\|\s*cat|\|\s*ls</regex>
    <description>CR-API: Command injection attempt detected</description>
    <group>command_injection,crapi,attack</group>
  </rule>

  <!-- CR-API Path Traversal -->
  <rule id="100005" level="8">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>\.\./|\.\.\\|/etc/passwd|/etc/shadow|\.\.%2f|\.\.%5c</regex>
    <description>CR-API: Path traversal attempt detected</description>
    <group>path_traversal,crapi,attack</group>
  </rule>

  <!-- CR-API API Abuse -->
  <rule id="100006" level="7">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>rate.limit|too.many.requests|429</regex>
    <description>CR-API: API rate limit exceeded</description>
    <group>api_abuse,crapi</group>
  </rule>

  <!-- CR-API Error 500 -->
  <rule id="100007" level="6">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>500|internal.server.error|exception|error</regex>
    <description>CR-API: Internal server error detected</description>
    <group>server_error,crapi</group>
  </rule>

  <!-- CR-API Unauthorized Access -->
  <rule id="100008" level="8">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>401|403|unauthorized|forbidden|access.denied</regex>
    <description>CR-API: Unauthorized access attempt</description>
    <group>unauthorized_access,crapi</group>
  </rule>

  <!-- CR-API File Upload Abuse -->
  <rule id="100009" level="9">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-workshop</field>
    <regex>\.php|\.jsp|\.asp|\.exe|\.sh|malicious.file</regex>
    <description>CR-API: Suspicious file upload detected</description>
    <group>file_upload,crapi,attack</group>
  </rule>

  <!-- CR-API BOLA/IDOR -->
  <rule id="100010" level="10">
    <decoded_as>json</decoded_as>
    <field name="container.name">crapi-</field>
    <regex>access.other.user|unauthorized.resource|idor|bola</regex>
    <description>CR-API: Broken Object Level Authorization (BOLA/IDOR) detected</description>
    <group>bola,idor,crapi,attack</group>
  </rule>

</group>
